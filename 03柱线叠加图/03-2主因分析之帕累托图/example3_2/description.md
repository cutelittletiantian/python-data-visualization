# example3_2

## 1 案例背景

高三备考期间，某个年级最近一次数学考试整体考得稀烂。

备课组组长老师快要气秃了，于是决定：

* 调查一下各种题型的扣分情况
  
* 决定下周就哪些扣分严重的项目展开专题习题课
  
> One fact: 如果所有题型都能在下周开专题习题课那当然是最好，
> 但是老师们精力有限，还要考虑到学生的消化能力。

因此**不能在下周一次性覆盖到所有题型的专题**，所以要想**哪些扣分知识点最主要**应当**优先**上专题课，
从而在接下来一周**时间、精力有限的条件下**，尽**最大程度**地解决问题。
  
## 2 图像选择：帕累托图（Pareto Chart）

### 2.1 什么是帕累托图

帕累托图的本质是一个柱状图和一个折线图的叠加，二者共x轴，分别使用不同的y轴。

* 柱状图部分的y轴：x轴字段对应的直接数据。且帕累托图绘制时要求从左到右**y轴必须自大到小排列下来**
  （当然y轴讲顺序x轴也会对应上的......）
  
* 折线图部分的y轴：x轴当前字段，**加上当前字段之前所有字段**，的柱状图的**面积占比**，
  所以由此可以发现，折线图在帕累托图中**始终是向上趋势，且上升到最后一个x轴字段的时候值一定是100%**
  
### 2.2 帕累托图的意义和作用

意义：

* 柱状图的意义：y轴从大到小排开，能够表现出x轴字段的**优先情况（重要性）**

* 折线图的意义：反映出x轴字段代表的事件在依照优先次序处理的情况下**完成的进度**

作用：

结合**80-20原则**，折线图80%处经过的x轴字段，重要性往往较高（柱状图直接取值很大），
在条件有限的情况下，先处理掉前80%的内容，可以在**控制成本的条件下尽快抓住问题主要矛盾着手应对**，提升效率。

> 以本例为说明：备课组老师利用帕累托图可以这样决策备课

* 柱状图：把知识点按扣分情况排序

* 折线图：找到80%取值的位置，选出之前所有的知识点

* 决策：先组织年级备课前80%的知识点专题课，其它知识点不是造成扣分的主要原因，专题讲了也没啥用，多半是粗心搞的

## 3 绘图过程

老师怎么备课就轮不到我们操心了，我们只要画出图来就行。

> 注意：绘图有时不会一次性绘制得很漂亮，所以应当在指定好坐标轴的前提下，一点点去试着绘图，逐渐完善图片的细节。
> 下面的绘图执行细节步骤就是针对本例一点点试出来的。

### 3.1 读取原始数据

来源：可能是年级数学校验组统计考试扣分情况的表格中提取出来的字典

字段：**知识点名称 | 平均扣分值** ，以字典存储

### 3.2 绘图数据的准备

x轴：知识点名称（柱线公共）

y轴：

* 柱状图：平均扣分的取值，由左至右必须从大到小排列

* 折线图：知识点出现的累计占比（当前知识点及其左边知识点柱状图的面积和占柱状图总面积比），纵坐标取值必须是百分数（不含%号）

### 3.3 帕累托图的柱状图部分绘制

1. x轴是知识点名称xaxis_data，适当倾斜以防止横坐标之间相互遮挡显示不全

2. y轴是平均失分的直接数值yaxis_data，图例“扣分”

3. 柱状图标题设置为“数学模块最薄弱的失分点”

4. 另起空y轴（extend_axis向yaxis依赖注入），用于后续累加的折线图纵轴取值

### 3.4 帕累托图的折线图部分绘制

1. x轴是知识点名称xaxis_data
   
2. y轴是知识点出现的累计占比（当前知识点及其左边知识点柱状图的面积和占柱状图总面积比，percentList），图例“扣分占比”
   
3. x轴确保和帕累托图的柱状图部分一致
   
4. y轴用帕累托图的柱状图部分之前创建的空y轴（后创建的y轴，yaxis_index为1）
   
5. 线容易被柱子挡住，确保折线图放在比柱状图更高图层的位置（z_level大）

### 3.5 合成帕累托图

说白了，就是往柱状图上**叠加**(overlap)折线图

### 3.6 执行保存

由于上一步合成帕累托图的时候，折线图加在了柱状图上，所以保存应该保存柱状图。
